# language: pt

Funcionalidade: Consultas de nós

  Contexto:
    Dado que o smart contract de gestão de endereços de admin está implantado
    # A conta 0x8626f6940E2eb28930eFb4CeF49B2d1F2C9C1199 é utilizada como admin,
    # conforme conceito da primeira geração do permissionamento, que representará
    # o smart contract de governança/votação.
    E o endereço "0x8626f6940E2eb28930eFb4CeF49B2d1F2C9C1199" é admin
    # BNDES será organização 1
    E a organização "BNDES" com direito de voto "true"
    # TCU será organização 2
    E a organização "TCU" com direito de voto "true"
    # OrgExc será organização 3
    E a organização "OrgExc" com direito de voto "true"
    E implanto o smart contract de gestão de organizações
    E a implantação do smart contract de gestão de organizações ocorre com sucesso
    # Administrador global da organização 1 - BNDES
    E a conta "0x71bE63f3384f5fb98995898A86B02Fb2426c5788"
    # Administrador global da organização 2 - TCU
    E a conta "0xFABB0ac9d68B0B445fB7357272Ff202C5651694a"
    # Administrador global da organização 3 - OrgExc
    E a conta "0x2546BcD3c84621e976D8185a91A922aE77ECEc30"
    E implanto o smart contract de gestão de contas
    E a implantação do smart contract de gestão de contas ocorre com sucesso
    E implanto o smart contract de gestão de nós
    E a implantação do smart contract de gestão de nós ocorre com sucesso
    # Administrador global do BNDES adiciona nós
    E a conta "0x71bE63f3384f5fb98995898A86B02Fb2426c5788" informa o endereço "0x0000000000000000000000000000000000000000000000000000000000000001" "0x0000000000000000000000000000000000000000000000000000000000000001", o nome "validator01" e o tipo "Validator" do nó para cadastrá-lo
    E a conta "0x71bE63f3384f5fb98995898A86B02Fb2426c5788" informa o endereço "0x0000000000000000000000000000000000000000000000000000000000000001" "0x0000000000000000000000000000000000000000000000000000000000000002", o nome "boot01" e o tipo "Boot" do nó para cadastrá-lo
    E a conta "0x71bE63f3384f5fb98995898A86B02Fb2426c5788" informa o endereço "0x0000000000000000000000000000000000000000000000000000000000000001" "0x0000000000000000000000000000000000000000000000000000000000000003", o nome "writer01" e o tipo "Writer" do nó para cadastrá-lo
    E a conta "0x71bE63f3384f5fb98995898A86B02Fb2426c5788" informa o endereço "0x0000000000000000000000000000000000000000000000000000000000000001" "0x0000000000000000000000000000000000000000000000000000000000000004", o nome "observer-boot01" e o tipo "ObserverBoot" do nó para cadastrá-lo
    # Administrador global do TCU adiciona nós
    E a conta "0xFABB0ac9d68B0B445fB7357272Ff202C5651694a" informa o endereço "0x0000000000000000000000000000000000000000000000000000000000000002" "0x0000000000000000000000000000000000000000000000000000000000000001", o nome "validator01" e o tipo "Validator" do nó para cadastrá-lo
    E a conta "0xFABB0ac9d68B0B445fB7357272Ff202C5651694a" informa o endereço "0x0000000000000000000000000000000000000000000000000000000000000002" "0x0000000000000000000000000000000000000000000000000000000000000002", o nome "boot01" e o tipo "Boot" do nó para cadastrá-lo
    # Administrador global da OrgExc adiciona nós
    E a conta "0x2546BcD3c84621e976D8185a91A922aE77ECEc30" informa o endereço "0x0000000000000000000000000000000000000000000000000000000000000003" "0x0000000000000000000000000000000000000000000000000000000000000001", o nome "validator01" e o tipo "Validator" do nó para cadastrá-lo
    E a conta "0x2546BcD3c84621e976D8185a91A922aE77ECEc30" informa o endereço "0x0000000000000000000000000000000000000000000000000000000000000003" "0x0000000000000000000000000000000000000000000000000000000000000002", o nome "boot01" e o tipo "Boot" do nó para cadastrá-lo
    # Verificando cadastro das organizações
    E a lista de organizações é "1,BNDES,true|2,TCU,true|3,OrgExc,true"
    # Verificando cadastro de nós
    E a quantidade total de nós é 8
    E o nó "0x0000000000000000000000000000000000000000000000000000000000000001" "0x0000000000000000000000000000000000000000000000000000000000000001" é da organização 1, tem o nome "validator01", tipo "Validator" e situação ativa true
    E o nó "0x0000000000000000000000000000000000000000000000000000000000000001" "0x0000000000000000000000000000000000000000000000000000000000000002" é da organização 1, tem o nome "boot01", tipo "Boot" e situação ativa true
    E o nó "0x0000000000000000000000000000000000000000000000000000000000000002" "0x0000000000000000000000000000000000000000000000000000000000000001" é da organização 2, tem o nome "validator01", tipo "Validator" e situação ativa true
    E o nó "0x0000000000000000000000000000000000000000000000000000000000000002" "0x0000000000000000000000000000000000000000000000000000000000000002" é da organização 2, tem o nome "boot01", tipo "Boot" e situação ativa true
    E o nó "0x0000000000000000000000000000000000000000000000000000000000000003" "0x0000000000000000000000000000000000000000000000000000000000000001" é da organização 3, tem o nome "validator01", tipo "Validator" e situação ativa true
    E o nó "0x0000000000000000000000000000000000000000000000000000000000000003" "0x0000000000000000000000000000000000000000000000000000000000000002" é da organização 3, tem o nome "boot01", tipo "Boot" e situação ativa true
    # Governança exclui a OrgExc, logo, suas contas ficarão inativas
    E a conta "0x8626f6940E2eb28930eFb4CeF49B2d1F2C9C1199" exclui a organização 3
    E verifico se a organização 3 está ativa o resultado é "false"
    E a lista de organizações é "1,BNDES,true|2,TCU,true"

  ##############################################################################
  # Consulta de nós
  ##############################################################################

  Cenário: Consulta de todos os nós em uma única página
    Quando consulto os nós a partir da página 1 com tamanho de página 100
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,1,true|0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,1,true|0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000003,Writer,writer01,1,true|0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000004,ObserverBoot,observer-boot01,1,true|0x0000000000000000000000000000000000000000000000000000000000000002,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,2,true|0x0000000000000000000000000000000000000000000000000000000000000002,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,2,true|0x0000000000000000000000000000000000000000000000000000000000000003,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,3,true|0x0000000000000000000000000000000000000000000000000000000000000003,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,3,true"
    E a quantidade total de nós é 8
    Quando consulto os nós a partir da página 1 com tamanho de página 8
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,1,true|0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,1,true|0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000003,Writer,writer01,1,true|0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000004,ObserverBoot,observer-boot01,1,true|0x0000000000000000000000000000000000000000000000000000000000000002,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,2,true|0x0000000000000000000000000000000000000000000000000000000000000002,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,2,true|0x0000000000000000000000000000000000000000000000000000000000000003,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,3,true|0x0000000000000000000000000000000000000000000000000000000000000003,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,3,true"
    E a quantidade total de nós é 8

  Cenário: Consulta de todos as nós com página de um elemento apenas
    Quando consulto os nós a partir da página 1 com tamanho de página 1
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,1,true"
    Quando consulto os nós a partir da página 2 com tamanho de página 1
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,1,true"
    Quando consulto os nós a partir da página 3 com tamanho de página 1
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000003,Writer,writer01,1,true"
    Quando consulto os nós a partir da página 4 com tamanho de página 1
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000004,ObserverBoot,observer-boot01,1,true"
    Quando consulto os nós a partir da página 5 com tamanho de página 1
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000002,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,2,true"
    Quando consulto os nós a partir da página 6 com tamanho de página 1
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000002,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,2,true"
    Quando consulto os nós a partir da página 7 com tamanho de página 1
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000003,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,3,true"
    Quando consulto os nós a partir da página 8 com tamanho de página 1
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000003,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,3,true"

  Cenário: Consulta de todos os nós com paginação em sequência
    Quando consulto os nós a partir da página 1 com tamanho de página 3
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,1,true|0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,1,true|0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000003,Writer,writer01,1,true"
    Quando consulto os nós a partir da página 2 com tamanho de página 3
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000004,ObserverBoot,observer-boot01,1,true|0x0000000000000000000000000000000000000000000000000000000000000002,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,2,true|0x0000000000000000000000000000000000000000000000000000000000000002,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,2,true"
    Quando consulto os nós a partir da página 3 com tamanho de página 3
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000003,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,3,true|0x0000000000000000000000000000000000000000000000000000000000000003,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,3,true"

  Cenário: Consulta de todos os nós após exclusão de nós
    # Administrador global do BNDES exclui nó
    Quando a conta "0x71bE63f3384f5fb98995898A86B02Fb2426c5788" informa o endereço "0x0000000000000000000000000000000000000000000000000000000000000001" "0x0000000000000000000000000000000000000000000000000000000000000004" para exclusão
    Então a transação ocorre com sucesso
    E a quantidade total de nós é 7
    Quando consulto os nós a partir da página 1 com tamanho de página 100
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,1,true|0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,1,true|0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000003,Writer,writer01,1,true|0x0000000000000000000000000000000000000000000000000000000000000003,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,3,true|0x0000000000000000000000000000000000000000000000000000000000000002,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,2,true|0x0000000000000000000000000000000000000000000000000000000000000002,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,2,true|0x0000000000000000000000000000000000000000000000000000000000000003,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,3,true"

  Cenário: Consulta de todos os nós com parâmetro de página inválido
    Quando consulto os nós a partir da página 0 com tamanho de página 10
    Então ocorre erro "InvalidPaginationParameter" na consulta de nós
    
  Cenário: Consulta de todos os nós com parâmetro de tamanho de página inválido
    Quando consulto os nós a partir da página 1 com tamanho de página 0
    Então ocorre erro "InvalidPaginationParameter" na consulta de nós
    
  Cenário: Consulta de todos os nós com paginação além do tamanho do resultado
    Quando consulto os nós a partir da página 2 com tamanho de página 8
    Então o resultado da consulta de nós é ""
    Quando consulto os nós a partir da página 2 com tamanho de página 9
    Então o resultado da consulta de nós é ""
    Quando consulto os nós a partir da página 3 com tamanho de página 8
    Então o resultado da consulta de nós é ""


  ##############################################################################
  # Consulta de nós por organização
  ##############################################################################

  Cenário: Consulta de nós por organização em uma única página
    Quando consulto os nós da organização 1 a partir da página 1 com tamanho de página 100
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,1,true|0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,1,true|0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000003,Writer,writer01,1,true|0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000004,ObserverBoot,observer-boot01,1,true"
    E a quantidade de nós da organização 1 é 4
    Quando consulto os nós da organização 2 a partir da página 1 com tamanho de página 100
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000002,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,2,true|0x0000000000000000000000000000000000000000000000000000000000000002,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,2,true"
    E a quantidade de nós da organização 2 é 2
    Quando consulto os nós da organização 3 a partir da página 1 com tamanho de página 100
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000003,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,3,true|0x0000000000000000000000000000000000000000000000000000000000000003,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,3,true"
    E a quantidade de nós da organização 2 é 2

  Cenário: Consulta de nós por organização com página de um elemento apenas
    Quando consulto os nós da organização 1 a partir da página 1 com tamanho de página 1
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,1,true"
    Quando consulto os nós da organização 1 a partir da página 2 com tamanho de página 1
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000002,Boot,boot01,1,true"
    Quando consulto os nós da organização 1 a partir da página 3 com tamanho de página 1
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000003,Writer,writer01,1,true"
    Quando consulto os nós da organização 1 a partir da página 4 com tamanho de página 1
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000004,ObserverBoot,observer-boot01,1,true"

  Cenário: Consulta de nós por organização após exclusão de nós
    # Administrador global do BNDES exclui nó
    Quando a conta "0x71bE63f3384f5fb98995898A86B02Fb2426c5788" informa o endereço "0x0000000000000000000000000000000000000000000000000000000000000001" "0x0000000000000000000000000000000000000000000000000000000000000002" para exclusão
    Então a transação ocorre com sucesso
    Quando consulto os nós da organização 1 a partir da página 1 com tamanho de página 100
    Então o resultado da consulta de nós é "0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000001,Validator,validator01,1,true|0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000004,ObserverBoot,observer-boot01,1,true|0x0000000000000000000000000000000000000000000000000000000000000001,0x0000000000000000000000000000000000000000000000000000000000000003,Writer,writer01,1,true"
    E a quantidade de nós da organização 1 é 3

  Cenário: Consulta de nós de organização que não existe
    Quando consulto os nós da organização 10 a partir da página 1 com tamanho de página 100
    Então o resultado da consulta de nós é ""
    E a quantidade de nós da organização 10 é 0

  Cenário: Consulta de nós por organização com parâmetro de página inválido
    Quando consulto os nós da organização 1 a partir da página 0 com tamanho de página 10
    Então ocorre erro "InvalidPaginationParameter" na consulta de nós
    
  Cenário: Consulta de nós por organização com parâmetro de tamanho de página inválido
    Quando consulto os nós da organização 1 a partir da página 1 com tamanho de página 0
    Então ocorre erro "InvalidPaginationParameter" na consulta de nós
    
  Cenário: Consulta de nós por organização com paginação além do tamanho do resultado
    Quando consulto os nós da organização 1 a partir da página 2 com tamanho de página 4
    Então o resultado da consulta de nós é ""
    Quando consulto os nós da organização 1 a partir da página 2 com tamanho de página 5
    Então o resultado da consulta de nós é ""
    Quando consulto os nós da organização 1 a partir da página 3 com tamanho de página 4
    Então o resultado da consulta de nós é ""
